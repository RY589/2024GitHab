<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>給与計算アプリ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .input-form, .calendar-view, .result-view {
            display: none;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 40px);
            grid-gap: 5px;
        }
        .day {
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        .selected {
            background-color: #4CAF50;
            color: white;
        }
        .tooltip {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .buttons {
            margin-top: 10px;
        }
        .buttons button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }
        .buttons button:hover {
            background-color: #45a049;
        }
        .result-item {
            margin-bottom: 10px;
        }
        .result-total {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .result-detail {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 初期設定の入力フォーム -->
        <div class="input-form" style="display: block;">
            <h2>初期設定</h2>
            <label for="hourlyWage">時給:</label>
            <input type="text" id="hourlyWage"><br><br>
            <label for="dailyTransportCost">1日の交通費:</label>
            <input type="text" id="dailyTransportCost"><br><br>
            <button onclick="nextToCalendar()">次へ</button>
        </div>

        <!-- カレンダーを日付UIで表示する画面 -->
        <div class="calendar-view">
            <h2>日付選択</h2>
            <div id="calendar" class="calendar"></div>
            <div class="buttons">
                <button onclick="calculateSalary()">計算</button>
                <button onclick="backToInputForm()">初期設定に戻る</button>
            </div>
        </div>

        <!-- 結果表示画面 -->
        <div class="result-view">
            <h2>結果</h2>
            <div id="resultMessage"></div>
            <button onclick="backToInputForm()">初期設定に戻る</button>
        </div>

        <!-- ツールチップ -->
        <div id="tooltip" class="tooltip">
            <h3>勤務時間と祝日選択</h3>
            <label for="workHours">勤務時間:</label>
            <input type="text" id="workHours"><br><br>
            <label for="isHoliday">祝日ですか？</label>
            <input type="checkbox" id="isHoliday"><br><br>
            <div id="holidayBonusField" style="display: none;">
                <label for="holidayBonus">祝日の時給ボーナス額:</label>
                <input type="text" id="holidayBonus"><br><br>
            </div>
            <button onclick="saveDate()">保存</button>
            <button onclick="hideTooltip()">戻る</button>
        </div>
    </div>

    <script>
        let hourlyWage;
        let dailyTransportCost;
        let selectedDates = {};
        let currentSelectedDate;

        // 初期設定から日付選択画面へ遷移する関数
        function nextToCalendar() {
            hourlyWage = parseFloat(document.getElementById('hourlyWage').value);
            dailyTransportCost = parseFloat(document.getElementById('dailyTransportCost').value);

            // 入力チェック
            if (isNaN(hourlyWage) || isNaN(dailyTransportCost)) {
                alert('時給と1日の交通費を数値で入力してください。');
                return;
            }

            document.querySelector('.input-form').style.display = 'none';
            document.querySelector('.calendar-view').style.display = 'block';
            generateCalendar();
        }

        // 戻るボタンで初期設定画面へ戻る関数
        function backToInputForm() {
            document.querySelector('.input-form').style.display = 'block';
            document.querySelector('.calendar-view').style.display = 'none';
            document.querySelector('.result-view').style.display = 'none';

            // リセット処理
            selectedDates = {};
            currentSelectedDate = null;
            document.getElementById('resultMessage').innerHTML = '';
        }

        // カレンダーを生成する関数
        function generateCalendar() {
            let calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            // 今月の日数を取得
            let date = new Date();
            let year = date.getFullYear();
            let month = date.getMonth();
            let daysInMonth = new Date(year, month + 1, 0).getDate();

            // 日付を1日から始めるための調整
            let firstDay = new Date(year, month, 1).getDay();

            // カレンダーの日付部分を生成
            for (let i = 0; i < firstDay; i++) {
                let dayDiv = document.createElement('div');
                dayDiv.classList.add('day');
                calendar.appendChild(dayDiv);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                let dayDiv = document.createElement('div');
                dayDiv.classList.add('day');
                dayDiv.textContent = day;
                dayDiv.setAttribute('data-date', `${year}-${month + 1}-${day}`);
                dayDiv.onclick = toggleSelect;
                calendar.appendChild(dayDiv);
            }
        }

        // 日付の選択を切り替える関数
        function toggleSelect(event) {
            let selectedDate = event.target.getAttribute('data-date');
            currentSelectedDate = selectedDate;

            if (!selectedDates[selectedDate]) {
                // 日付が選択されていない場合
                event.target.classList.add('selected');
                showTooltip(event.pageX, event.pageY);
            } else {
                // 日付が既に選択されている場合
                delete selectedDates[selectedDate];
                event.target.classList.remove('selected');
                hideTooltip();
            }
        }

        // ツールチップを表示する関数
        function showTooltip(x, y) {
            let tooltip = document.getElementById('tooltip');
            tooltip.style.left = x + 'px';
            tooltip.style.top = y + 'px';
            tooltip.style.display = 'block';

            let isHolidayCheckbox = document.getElementById('isHoliday');
            isHolidayCheckbox.onchange = function() {
                document.getElementById('holidayBonusField').style.display = this.checked ? 'block' : 'none';
            };
        }

        // ツールチップを隠す関数
        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        // 日付の保存と計算の準備をする関数
        function saveDate() {
            let workHours = parseFloat(document.getElementById('workHours').value);
            let isHoliday = document.getElementById('isHoliday').checked;
            let holidayBonus = isHoliday ? parseFloat(document.getElementById('holidayBonus').value) : 0;

            // 保存処理
            selectedDates[currentSelectedDate] = {
                workHours: workHours,
                isHoliday: isHoliday,
                holidayBonus: holidayBonus
            };

            // フィールドの初期化
            document.getElementById('workHours').value = '';
            document.getElementById('isHoliday').checked = false;
            document.getElementById('holidayBonusField').style.display = 'none';
            document.getElementById('holidayBonus').value = '';

            hideTooltip();
        }

        // 計算を実行する関数
        function calculateSalary() {
            let totalSalary = 0;
            let resultMessage = '';

            for (let date in selectedDates) {
                let dateInfo = selectedDates[date];
                let dailyWage = hourlyWage * dateInfo.workHours;
                let holidayBonus = dateInfo.isHoliday ? dateInfo.holidayBonus * dateInfo.workHours : 0;
                let totalDailyWage = dailyWage + holidayBonus + dailyTransportCost;

                resultMessage += `
                    <div class="result-item result-detail">
                        <h3>${date}</h3>
                        <p>通常の給料: ${dailyWage.toFixed(0)}円</p>
                        <p>支給交通費: ${dailyTransportCost.toFixed(0)}円</p>
                        <p>祝日ボーナス: ${holidayBonus.toFixed(0)}円</p>
                        <p>合計給与: ${totalDailyWage.toFixed(0)}円</p>
                    </div>
                `;

                totalSalary += totalDailyWage;
            }

            // 結果表示
            let resultView = document.querySelector('.result-view');
            resultView.style.display = 'block';
            document.querySelector('.calendar-view').style.display = 'none';
            document.getElementById('resultMessage').innerHTML = `
                <p class="result-total">総支給額: ${totalSalary.toFixed(0)}円</p>
                ${resultMessage}
            `;
        }
    </script>
</body>
</html>
